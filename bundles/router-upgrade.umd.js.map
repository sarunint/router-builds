{"version":3,"file":"router-upgrade.umd.js","sources":["../../../packages/router/esm5/upgrade/src/upgrade.js"],"sourcesContent":["/**\n * @fileoverview added by tsickle\n * @suppress {checkTypes,extraRequire,uselessCode} checked by tsc\n */\n/**\n * @license\n * Copyright Google Inc. All Rights Reserved.\n *\n * Use of this source code is governed by an MIT-style license that can be\n * found in the LICENSE file at https://angular.io/license\n */\nimport { Location } from '@angular/common';\nimport { APP_BOOTSTRAP_LISTENER } from '@angular/core';\nimport { Router } from '@angular/router';\nimport { UpgradeModule } from '@angular/upgrade/static';\n/** *\n * \\@description\n *\n * Creates an initializer that in addition to setting up the Angular\n * router sets up the ngRoute integration.\n *\n * ```\n * \\@NgModule({\n *  imports: [\n *   RouterModule.forRoot(SOME_ROUTES),\n *   UpgradeModule\n * ],\n * providers: [\n *   RouterUpgradeInitializer\n * ]\n * })\n * export class AppModule {\n *   ngDoBootstrap() {}\n * }\n * ```\n *\n * \\@publicApi\n  @type {?} */\nexport var RouterUpgradeInitializer = {\n    provide: APP_BOOTSTRAP_LISTENER,\n    multi: true,\n    useFactory: /** @type {?} */ (locationSyncBootstrapListener),\n    deps: [UpgradeModule]\n};\n/**\n * \\@internal\n * @param {?} ngUpgrade\n * @return {?}\n */\nexport function locationSyncBootstrapListener(ngUpgrade) {\n    return function () { setUpLocationSync(ngUpgrade); };\n}\n/**\n * \\@description\n *\n * Sets up a location synchronization.\n *\n * History.pushState does not fire onPopState, so the Angular location\n * doesn't detect it. The workaround is to attach a location change listener\n *\n * \\@publicApi\n * @param {?} ngUpgrade\n * @return {?}\n */\nexport function setUpLocationSync(ngUpgrade) {\n    if (!ngUpgrade.$injector) {\n        throw new Error(\"\\n        RouterUpgradeInitializer can be used only after UpgradeModule.bootstrap has been called.\\n        Remove RouterUpgradeInitializer and call setUpLocationSync after UpgradeModule.bootstrap.\\n      \");\n    }\n    /** @type {?} */\n    var router = ngUpgrade.injector.get(Router);\n    /** @type {?} */\n    var location = ngUpgrade.injector.get(Location);\n    ngUpgrade.$injector.get('$rootScope')\n        .$on('$locationChangeStart', function (_, next, __) {\n        /** @type {?} */\n        var url = resolveUrl(next);\n        /** @type {?} */\n        var path = location.normalize(url.pathname);\n        router.navigateByUrl(path + url.search + url.hash);\n    });\n}\n/** *\n * Normalize and parse a URL.\n *\n * - Normalizing means that a relative URL will be resolved into an absolute URL in the context of\n *   the application document.\n * - Parsing means that the anchor's `protocol`, `hostname`, `port`, `pathname` and related\n *   properties are all populated to reflect the normalized URL.\n *\n * While this approach has wide compatibility, it doesn't work as expected on IE. On IE, normalizing\n * happens similar to other browsers, but the parsed components will not be set. (E.g. if you assign\n * `a.href = 'foo'`, then `a.protocol`, `a.host`, etc. will not be correctly updated.)\n * We work around that by performing the parsing in a 2nd step by taking a previously normalized URL\n * and assigning it again. This correctly populates all properties.\n *\n * See\n * https://github.com/angular/angular.js/blob/2c7400e7d07b0f6cec1817dab40b9250ce8ebce6/src/ng/urlUtils.js#L26-L33\n * for more info.\n  @type {?} */\nvar anchor;\n/**\n * @param {?} url\n * @return {?}\n */\nfunction resolveUrl(url) {\n    if (!anchor) {\n        anchor = document.createElement('a');\n    }\n    anchor.setAttribute('href', url);\n    anchor.setAttribute('href', anchor.href);\n    return {\n        // IE does not start `pathname` with `/` like other browsers.\n        pathname: \"/\" + anchor.pathname.replace(/^\\//, ''),\n        search: anchor.search,\n        hash: anchor.hash\n    };\n}\n//# sourceMappingURL=upgrade.js.map"],"names":["APP_BOOTSTRAP_LISTENER","UpgradeModule","Router","Location"],"mappings":";;;;;;;;;;;AAAA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAsCA,IAAW,wBAAwB,GAAG;IAClC,OAAO,EAAEA,oCAAsB;IAC/B,KAAK,EAAE,IAAI;IACX,UAAU,oBAAoB,6BAA6B,CAAC;IAC5D,IAAI,EAAE,CAACC,qCAAa,CAAC;CACxB,CAAC;;;;;;AAMF,SAAgB,6BAA6B,CAAC,SAAS,EAAE;IACrD,OAAO,YAAY,EAAE,iBAAiB,CAAC,SAAS,CAAC,CAAC,EAAE,CAAC;CACxD;;;;;;;;;;;;;AAaD,SAAgB,iBAAiB,CAAC,SAAS,EAAE;IACzC,IAAI,CAAC,SAAS,CAAC,SAAS,EAAE;QACtB,MAAM,IAAI,KAAK,CAAC,+MAA+M,CAAC,CAAC;KACpO;;IAED,IAAI,MAAM,GAAG,SAAS,CAAC,QAAQ,CAAC,GAAG,CAACC,sBAAM,CAAC,CAAC;;IAE5C,IAAI,QAAQ,GAAG,SAAS,CAAC,QAAQ,CAAC,GAAG,CAACC,wBAAQ,CAAC,CAAC;IAChD,SAAS,CAAC,SAAS,CAAC,GAAG,CAAC,YAAY,CAAC;SAChC,GAAG,CAAC,sBAAsB,EAAE,UAAU,CAAC,EAAE,IAAI,EAAE,EAAE,EAAE;;QAEpD,IAAI,GAAG,GAAG,UAAU,CAAC,IAAI,CAAC,CAAC;;QAE3B,IAAI,IAAI,GAAG,QAAQ,CAAC,SAAS,CAAC,GAAG,CAAC,QAAQ,CAAC,CAAC;QAC5C,MAAM,CAAC,aAAa,CAAC,IAAI,GAAG,GAAG,CAAC,MAAM,GAAG,GAAG,CAAC,IAAI,CAAC,CAAC;KACtD,CAAC,CAAC;CACN;;;;;;;;;;;;;;;;;;;AAmBD,IAAI,MAAM,CAAC;;;;;AAKX,SAAS,UAAU,CAAC,GAAG,EAAE;IACrB,IAAI,CAAC,MAAM,EAAE;QACT,MAAM,GAAG,QAAQ,CAAC,aAAa,CAAC,GAAG,CAAC,CAAC;KACxC;IACD,MAAM,CAAC,YAAY,CAAC,MAAM,EAAE,GAAG,CAAC,CAAC;IACjC,MAAM,CAAC,YAAY,CAAC,MAAM,EAAE,MAAM,CAAC,IAAI,CAAC,CAAC;IACzC,OAAO;;QAEH,QAAQ,EAAE,GAAG,GAAG,MAAM,CAAC,QAAQ,CAAC,OAAO,CAAC,KAAK,EAAE,EAAE,CAAC;QAClD,MAAM,EAAE,MAAM,CAAC,MAAM;QACrB,IAAI,EAAE,MAAM,CAAC,IAAI;KACpB,CAAC;CACL;;;;;;;;;;;;;;"}