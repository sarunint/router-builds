{"version":3,"file":"apply_redirects.js","sourceRoot":"","sources":["../../../../../packages/router/src/apply_redirects.ts"],"names":[],"mappings":"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","sourcesContent":["/**\n * @license\n * Copyright Google Inc. All Rights Reserved.\n *\n * Use of this source code is governed by an MIT-style license that can be\n * found in the LICENSE file at https://angular.io/license\n */\n\nimport {Injector, NgModuleRef} from '@angular/core';\nimport {EmptyError, Observable, Observer, from, of } from 'rxjs';\nimport {catchError, concatAll, every, first, map, mergeMap} from 'rxjs/operators';\n\nimport {LoadedRouterConfig, Route, Routes} from './config';\nimport {CanLoadFn} from './interfaces';\nimport {RouterConfigLoader} from './router_config_loader';\nimport {PRIMARY_OUTLET, Params, defaultUrlMatcher, navigationCancelingError} from './shared';\nimport {UrlSegment, UrlSegmentGroup, UrlSerializer, UrlTree} from './url_tree';\nimport {forEach, waitForMap, wrapIntoObservable} from './utils/collection';\nimport {isCanLoad, isFunction} from './utils/type_guards';\n\nclass NoMatch {\n  public segmentGroup: UrlSegmentGroup|null;\n\n  constructor(segmentGroup?: UrlSegmentGroup) { this.segmentGroup = segmentGroup || null; }\n}\n\nclass AbsoluteRedirect {\n  constructor(public urlTree: UrlTree) {}\n}\n\nfunction noMatch(segmentGroup: UrlSegmentGroup): Observable<UrlSegmentGroup> {\n  return new Observable<UrlSegmentGroup>(\n      (obs: Observer<UrlSegmentGroup>) => obs.error(new NoMatch(segmentGroup)));\n}\n\nfunction absoluteRedirect(newTree: UrlTree): Observable<any> {\n  return new Observable<UrlSegmentGroup>(\n      (obs: Observer<UrlSegmentGroup>) => obs.error(new AbsoluteRedirect(newTree)));\n}\n\nfunction namedOutletsRedirect(redirectTo: string): Observable<any> {\n  return new Observable<UrlSegmentGroup>(\n      (obs: Observer<UrlSegmentGroup>) => obs.error(new Error(\n          `Only absolute redirects can have named outlets. redirectTo: '${redirectTo}'`)));\n}\n\nfunction canLoadFails(route: Route): Observable<LoadedRouterConfig> {\n  return new Observable<LoadedRouterConfig>(\n      (obs: Observer<LoadedRouterConfig>) => obs.error(navigationCancelingError(\n          `Cannot load children because the guard of the route \"path: '${route.path}'\" returned false`)));\n}\n\n/**\n * Returns the `UrlTree` with the redirection applied.\n *\n * Lazy modules are loaded along the way.\n */\nexport function applyRedirects(\n    moduleInjector: Injector, configLoader: RouterConfigLoader, urlSerializer: UrlSerializer,\n    urlTree: UrlTree, config: Routes): Observable<UrlTree> {\n  return new ApplyRedirects(moduleInjector, configLoader, urlSerializer, urlTree, config).apply();\n}\n\nclass ApplyRedirects {\n  private allowRedirects: boolean = true;\n  private ngModule: NgModuleRef<any>;\n\n  constructor(\n      moduleInjector: Injector, private configLoader: RouterConfigLoader,\n      private urlSerializer: UrlSerializer, private urlTree: UrlTree, private config: Routes) {\n    this.ngModule = moduleInjector.get(NgModuleRef);\n  }\n\n  apply(): Observable<UrlTree> {\n    const expanded$ =\n        this.expandSegmentGroup(this.ngModule, this.config, this.urlTree.root, PRIMARY_OUTLET);\n    const urlTrees$ = expanded$.pipe(\n        map((rootSegmentGroup: UrlSegmentGroup) => this.createUrlTree(\n                rootSegmentGroup, this.urlTree.queryParams, this.urlTree.fragment !)));\n    return urlTrees$.pipe(catchError((e: any) => {\n      if (e instanceof AbsoluteRedirect) {\n        // after an absolute redirect we do not apply any more redirects!\n        this.allowRedirects = false;\n        // we need to run matching, so we can fetch all lazy-loaded modules\n        return this.match(e.urlTree);\n      }\n\n      if (e instanceof NoMatch) {\n        throw this.noMatchError(e);\n      }\n\n      throw e;\n    }));\n  }\n\n  private match(tree: UrlTree): Observable<UrlTree> {\n    const expanded$ =\n        this.expandSegmentGroup(this.ngModule, this.config, tree.root, PRIMARY_OUTLET);\n    const mapped$ = expanded$.pipe(\n        map((rootSegmentGroup: UrlSegmentGroup) =>\n                this.createUrlTree(rootSegmentGroup, tree.queryParams, tree.fragment !)));\n    return mapped$.pipe(catchError((e: any): Observable<UrlTree> => {\n      if (e instanceof NoMatch) {\n        throw this.noMatchError(e);\n      }\n\n      throw e;\n    }));\n  }\n\n  private noMatchError(e: NoMatch): any {\n    return new Error(`Cannot match any routes. URL Segment: '${e.segmentGroup}'`);\n  }\n\n  private createUrlTree(rootCandidate: UrlSegmentGroup, queryParams: Params, fragment: string):\n      UrlTree {\n    const root = rootCandidate.segments.length > 0 ?\n        new UrlSegmentGroup([], {[PRIMARY_OUTLET]: rootCandidate}) :\n        rootCandidate;\n    return new UrlTree(root, queryParams, fragment);\n  }\n\n  private expandSegmentGroup(\n      ngModule: NgModuleRef<any>, routes: Route[], segmentGroup: UrlSegmentGroup,\n      outlet: string): Observable<UrlSegmentGroup> {\n    if (segmentGroup.segments.length === 0 && segmentGroup.hasChildren()) {\n      return this.expandChildren(ngModule, routes, segmentGroup)\n          .pipe(map((children: any) => new UrlSegmentGroup([], children)));\n    }\n\n    return this.expandSegment(ngModule, segmentGroup, routes, segmentGroup.segments, outlet, true);\n  }\n\n  // Recursively expand segment groups for all the child outlets\n  private expandChildren(\n      ngModule: NgModuleRef<any>, routes: Route[],\n      segmentGroup: UrlSegmentGroup): Observable<{[name: string]: UrlSegmentGroup}> {\n    return waitForMap(\n        segmentGroup.children,\n        (childOutlet, child) => this.expandSegmentGroup(ngModule, routes, child, childOutlet));\n  }\n\n  private expandSegment(\n      ngModule: NgModuleRef<any>, segmentGroup: UrlSegmentGroup, routes: Route[],\n      segments: UrlSegment[], outlet: string,\n      allowRedirects: boolean): Observable<UrlSegmentGroup> {\n    return of (...routes).pipe(\n        map((r: any) => {\n          const expanded$ = this.expandSegmentAgainstRoute(\n              ngModule, segmentGroup, routes, r, segments, outlet, allowRedirects);\n          return expanded$.pipe(catchError((e: any) => {\n            if (e instanceof NoMatch) {\n              // TODO(i): this return type doesn't match the declared Observable<UrlSegmentGroup> -\n              // talk to Jason\n              return of (null) as any;\n            }\n            throw e;\n          }));\n        }),\n        concatAll(), first((s: any) => !!s), catchError((e: any, _: any) => {\n          if (e instanceof EmptyError || e.name === 'EmptyError') {\n            if (this.noLeftoversInUrl(segmentGroup, segments, outlet)) {\n              return of (new UrlSegmentGroup([], {}));\n            }\n            throw new NoMatch(segmentGroup);\n          }\n          throw e;\n        }));\n  }\n\n  private noLeftoversInUrl(segmentGroup: UrlSegmentGroup, segments: UrlSegment[], outlet: string):\n      boolean {\n    return segments.length === 0 && !segmentGroup.children[outlet];\n  }\n\n  private expandSegmentAgainstRoute(\n      ngModule: NgModuleRef<any>, segmentGroup: UrlSegmentGroup, routes: Route[], route: Route,\n      paths: UrlSegment[], outlet: string, allowRedirects: boolean): Observable<UrlSegmentGroup> {\n    if (getOutlet(route) !== outlet) {\n      return noMatch(segmentGroup);\n    }\n\n    if (route.redirectTo === undefined) {\n      return this.matchSegmentAgainstRoute(ngModule, segmentGroup, route, paths);\n    }\n\n    if (allowRedirects && this.allowRedirects) {\n      return this.expandSegmentAgainstRouteUsingRedirect(\n          ngModule, segmentGroup, routes, route, paths, outlet);\n    }\n\n    return noMatch(segmentGroup);\n  }\n\n  private expandSegmentAgainstRouteUsingRedirect(\n      ngModule: NgModuleRef<any>, segmentGroup: UrlSegmentGroup, routes: Route[], route: Route,\n      segments: UrlSegment[], outlet: string): Observable<UrlSegmentGroup> {\n    if (route.path === '**') {\n      return this.expandWildCardWithParamsAgainstRouteUsingRedirect(\n          ngModule, routes, route, outlet);\n    }\n\n    return this.expandRegularSegmentAgainstRouteUsingRedirect(\n        ngModule, segmentGroup, routes, route, segments, outlet);\n  }\n\n  private expandWildCardWithParamsAgainstRouteUsingRedirect(\n      ngModule: NgModuleRef<any>, routes: Route[], route: Route,\n      outlet: string): Observable<UrlSegmentGroup> {\n    const newTree = this.applyRedirectCommands([], route.redirectTo !, {});\n    if (route.redirectTo !.startsWith('/')) {\n      return absoluteRedirect(newTree);\n    }\n\n    return this.lineralizeSegments(route, newTree).pipe(mergeMap((newSegments: UrlSegment[]) => {\n      const group = new UrlSegmentGroup(newSegments, {});\n      return this.expandSegment(ngModule, group, routes, newSegments, outlet, false);\n    }));\n  }\n\n  private expandRegularSegmentAgainstRouteUsingRedirect(\n      ngModule: NgModuleRef<any>, segmentGroup: UrlSegmentGroup, routes: Route[], route: Route,\n      segments: UrlSegment[], outlet: string): Observable<UrlSegmentGroup> {\n    const {matched, consumedSegments, lastChild, positionalParamSegments} =\n        match(segmentGroup, route, segments);\n    if (!matched) return noMatch(segmentGroup);\n\n    const newTree = this.applyRedirectCommands(\n        consumedSegments, route.redirectTo !, <any>positionalParamSegments);\n    if (route.redirectTo !.startsWith('/')) {\n      return absoluteRedirect(newTree);\n    }\n\n    return this.lineralizeSegments(route, newTree).pipe(mergeMap((newSegments: UrlSegment[]) => {\n      return this.expandSegment(\n          ngModule, segmentGroup, routes, newSegments.concat(segments.slice(lastChild)), outlet,\n          false);\n    }));\n  }\n\n  private matchSegmentAgainstRoute(\n      ngModule: NgModuleRef<any>, rawSegmentGroup: UrlSegmentGroup, route: Route,\n      segments: UrlSegment[]): Observable<UrlSegmentGroup> {\n    if (route.path === '**') {\n      if (route.loadChildren) {\n        return this.configLoader.load(ngModule.injector, route)\n            .pipe(map((cfg: LoadedRouterConfig) => {\n              route._loadedConfig = cfg;\n              return new UrlSegmentGroup(segments, {});\n            }));\n      }\n\n      return of (new UrlSegmentGroup(segments, {}));\n    }\n\n    const {matched, consumedSegments, lastChild} = match(rawSegmentGroup, route, segments);\n    if (!matched) return noMatch(rawSegmentGroup);\n\n    const rawSlicedSegments = segments.slice(lastChild);\n    const childConfig$ = this.getChildConfig(ngModule, route, segments);\n\n    return childConfig$.pipe(mergeMap((routerConfig: LoadedRouterConfig) => {\n      const childModule = routerConfig.module;\n      const childConfig = routerConfig.routes;\n\n      const {segmentGroup, slicedSegments} =\n          split(rawSegmentGroup, consumedSegments, rawSlicedSegments, childConfig);\n\n      if (slicedSegments.length === 0 && segmentGroup.hasChildren()) {\n        const expanded$ = this.expandChildren(childModule, childConfig, segmentGroup);\n        return expanded$.pipe(\n            map((children: any) => new UrlSegmentGroup(consumedSegments, children)));\n      }\n\n      if (childConfig.length === 0 && slicedSegments.length === 0) {\n        return of (new UrlSegmentGroup(consumedSegments, {}));\n      }\n\n      const expanded$ = this.expandSegment(\n          childModule, segmentGroup, childConfig, slicedSegments, PRIMARY_OUTLET, true);\n      return expanded$.pipe(\n          map((cs: UrlSegmentGroup) =>\n                  new UrlSegmentGroup(consumedSegments.concat(cs.segments), cs.children)));\n    }));\n  }\n\n  private getChildConfig(ngModule: NgModuleRef<any>, route: Route, segments: UrlSegment[]):\n      Observable<LoadedRouterConfig> {\n    if (route.children) {\n      // The children belong to the same module\n      return of (new LoadedRouterConfig(route.children, ngModule));\n    }\n\n    if (route.loadChildren) {\n      // lazy children belong to the loaded module\n      if (route._loadedConfig !== undefined) {\n        return of (route._loadedConfig);\n      }\n\n      return runCanLoadGuard(ngModule.injector, route, segments)\n          .pipe(mergeMap((shouldLoad: boolean) => {\n            if (shouldLoad) {\n              return this.configLoader.load(ngModule.injector, route)\n                  .pipe(map((cfg: LoadedRouterConfig) => {\n                    route._loadedConfig = cfg;\n                    return cfg;\n                  }));\n            }\n            return canLoadFails(route);\n          }));\n    }\n\n    return of (new LoadedRouterConfig([], ngModule));\n  }\n\n  private lineralizeSegments(route: Route, urlTree: UrlTree): Observable<UrlSegment[]> {\n    let res: UrlSegment[] = [];\n    let c = urlTree.root;\n    while (true) {\n      res = res.concat(c.segments);\n      if (c.numberOfChildren === 0) {\n        return of (res);\n      }\n\n      if (c.numberOfChildren > 1 || !c.children[PRIMARY_OUTLET]) {\n        return namedOutletsRedirect(route.redirectTo !);\n      }\n\n      c = c.children[PRIMARY_OUTLET];\n    }\n  }\n\n  private applyRedirectCommands(\n      segments: UrlSegment[], redirectTo: string, posParams: {[k: string]: UrlSegment}): UrlTree {\n    return this.applyRedirectCreatreUrlTree(\n        redirectTo, this.urlSerializer.parse(redirectTo), segments, posParams);\n  }\n\n  private applyRedirectCreatreUrlTree(\n      redirectTo: string, urlTree: UrlTree, segments: UrlSegment[],\n      posParams: {[k: string]: UrlSegment}): UrlTree {\n    const newRoot = this.createSegmentGroup(redirectTo, urlTree.root, segments, posParams);\n    return new UrlTree(\n        newRoot, this.createQueryParams(urlTree.queryParams, this.urlTree.queryParams),\n        urlTree.fragment);\n  }\n\n  private createQueryParams(redirectToParams: Params, actualParams: Params): Params {\n    const res: Params = {};\n    forEach(redirectToParams, (v: any, k: string) => {\n      const copySourceValue = typeof v === 'string' && v.startsWith(':');\n      if (copySourceValue) {\n        const sourceName = v.substring(1);\n        res[k] = actualParams[sourceName];\n      } else {\n        res[k] = v;\n      }\n    });\n    return res;\n  }\n\n  private createSegmentGroup(\n      redirectTo: string, group: UrlSegmentGroup, segments: UrlSegment[],\n      posParams: {[k: string]: UrlSegment}): UrlSegmentGroup {\n    const updatedSegments = this.createSegments(redirectTo, group.segments, segments, posParams);\n\n    let children: {[n: string]: UrlSegmentGroup} = {};\n    forEach(group.children, (child: UrlSegmentGroup, name: string) => {\n      children[name] = this.createSegmentGroup(redirectTo, child, segments, posParams);\n    });\n\n    return new UrlSegmentGroup(updatedSegments, children);\n  }\n\n  private createSegments(\n      redirectTo: string, redirectToSegments: UrlSegment[], actualSegments: UrlSegment[],\n      posParams: {[k: string]: UrlSegment}): UrlSegment[] {\n    return redirectToSegments.map(\n        s => s.path.startsWith(':') ? this.findPosParam(redirectTo, s, posParams) :\n                                      this.findOrReturn(s, actualSegments));\n  }\n\n  private findPosParam(\n      redirectTo: string, redirectToUrlSegment: UrlSegment,\n      posParams: {[k: string]: UrlSegment}): UrlSegment {\n    const pos = posParams[redirectToUrlSegment.path.substring(1)];\n    if (!pos)\n      throw new Error(\n          `Cannot redirect to '${redirectTo}'. Cannot find '${redirectToUrlSegment.path}'.`);\n    return pos;\n  }\n\n  private findOrReturn(redirectToUrlSegment: UrlSegment, actualSegments: UrlSegment[]): UrlSegment {\n    let idx = 0;\n    for (const s of actualSegments) {\n      if (s.path === redirectToUrlSegment.path) {\n        actualSegments.splice(idx);\n        return s;\n      }\n      idx++;\n    }\n    return redirectToUrlSegment;\n  }\n}\n\nfunction runCanLoadGuard(\n    moduleInjector: Injector, route: Route, segments: UrlSegment[]): Observable<boolean> {\n  const canLoad = route.canLoad;\n  if (!canLoad || canLoad.length === 0) return of (true);\n\n  const obs = from(canLoad).pipe(map((injectionToken: any) => {\n    const guard = moduleInjector.get(injectionToken);\n    let guardVal;\n    if (isCanLoad(guard)) {\n      guardVal = guard.canLoad(route, segments);\n    } else if (isFunction<CanLoadFn>(guard)) {\n      guardVal = guard(route, segments);\n    } else {\n      throw new Error('Invalid CanLoad guard');\n    }\n    return wrapIntoObservable(guardVal);\n  }));\n\n  return obs.pipe(concatAll(), every(result => result === true));\n}\n\nfunction match(segmentGroup: UrlSegmentGroup, route: Route, segments: UrlSegment[]): {\n  matched: boolean,\n  consumedSegments: UrlSegment[],\n  lastChild: number,\n  positionalParamSegments: {[k: string]: UrlSegment}\n} {\n  if (route.path === '') {\n    if ((route.pathMatch === 'full') && (segmentGroup.hasChildren() || segments.length > 0)) {\n      return {matched: false, consumedSegments: [], lastChild: 0, positionalParamSegments: {}};\n    }\n\n    return {matched: true, consumedSegments: [], lastChild: 0, positionalParamSegments: {}};\n  }\n\n  const matcher = route.matcher || defaultUrlMatcher;\n  const res = matcher(segments, segmentGroup, route);\n\n  if (!res) {\n    return {\n      matched: false,\n      consumedSegments: <any[]>[],\n      lastChild: 0,\n      positionalParamSegments: {},\n    };\n  }\n\n  return {\n    matched: true,\n    consumedSegments: res.consumed !,\n    lastChild: res.consumed.length !,\n    positionalParamSegments: res.posParams !,\n  };\n}\n\nfunction split(\n    segmentGroup: UrlSegmentGroup, consumedSegments: UrlSegment[], slicedSegments: UrlSegment[],\n    config: Route[]) {\n  if (slicedSegments.length > 0 &&\n      containsEmptyPathRedirectsWithNamedOutlets(segmentGroup, slicedSegments, config)) {\n    const s = new UrlSegmentGroup(\n        consumedSegments, createChildrenForEmptySegments(\n                              config, new UrlSegmentGroup(slicedSegments, segmentGroup.children)));\n    return {segmentGroup: mergeTrivialChildren(s), slicedSegments: []};\n  }\n\n  if (slicedSegments.length === 0 &&\n      containsEmptyPathRedirects(segmentGroup, slicedSegments, config)) {\n    const s = new UrlSegmentGroup(\n        segmentGroup.segments, addEmptySegmentsToChildrenIfNeeded(\n                                   segmentGroup, slicedSegments, config, segmentGroup.children));\n    return {segmentGroup: mergeTrivialChildren(s), slicedSegments};\n  }\n\n  return {segmentGroup, slicedSegments};\n}\n\nfunction mergeTrivialChildren(s: UrlSegmentGroup): UrlSegmentGroup {\n  if (s.numberOfChildren === 1 && s.children[PRIMARY_OUTLET]) {\n    const c = s.children[PRIMARY_OUTLET];\n    return new UrlSegmentGroup(s.segments.concat(c.segments), c.children);\n  }\n\n  return s;\n}\n\nfunction addEmptySegmentsToChildrenIfNeeded(\n    segmentGroup: UrlSegmentGroup, slicedSegments: UrlSegment[], routes: Route[],\n    children: {[name: string]: UrlSegmentGroup}): {[name: string]: UrlSegmentGroup} {\n  const res: {[name: string]: UrlSegmentGroup} = {};\n  for (const r of routes) {\n    if (isEmptyPathRedirect(segmentGroup, slicedSegments, r) && !children[getOutlet(r)]) {\n      res[getOutlet(r)] = new UrlSegmentGroup([], {});\n    }\n  }\n  return {...children, ...res};\n}\n\nfunction createChildrenForEmptySegments(\n    routes: Route[], primarySegmentGroup: UrlSegmentGroup): {[name: string]: UrlSegmentGroup} {\n  const res: {[name: string]: UrlSegmentGroup} = {};\n  res[PRIMARY_OUTLET] = primarySegmentGroup;\n  for (const r of routes) {\n    if (r.path === '' && getOutlet(r) !== PRIMARY_OUTLET) {\n      res[getOutlet(r)] = new UrlSegmentGroup([], {});\n    }\n  }\n  return res;\n}\n\nfunction containsEmptyPathRedirectsWithNamedOutlets(\n    segmentGroup: UrlSegmentGroup, segments: UrlSegment[], routes: Route[]): boolean {\n  return routes.some(\n      r => isEmptyPathRedirect(segmentGroup, segments, r) && getOutlet(r) !== PRIMARY_OUTLET);\n}\n\nfunction containsEmptyPathRedirects(\n    segmentGroup: UrlSegmentGroup, segments: UrlSegment[], routes: Route[]): boolean {\n  return routes.some(r => isEmptyPathRedirect(segmentGroup, segments, r));\n}\n\nfunction isEmptyPathRedirect(\n    segmentGroup: UrlSegmentGroup, segments: UrlSegment[], r: Route): boolean {\n  if ((segmentGroup.hasChildren() || segments.length > 0) && r.pathMatch === 'full') {\n    return false;\n  }\n\n  return r.path === '' && r.redirectTo !== undefined;\n}\n\nfunction getOutlet(route: Route): string {\n  return route.outlet || PRIMARY_OUTLET;\n}\n"]}