{"version":3,"file":"router_config_loader.js","sourceRoot":"","sources":["../../../../packages/router/src/router_config_loader.ts"],"names":[],"mappings":";;;;;;;;;;;AAQA,OAAO,EAAW,cAAc,EAAY,eAAe,EAAwB,MAAM,eAAe,CAAC;AAEzG,OAAO,EAAa,IAAI,EAAE,EAAE,EAAE,MAAM,MAAM,CAAC;AAC3C,OAAO,EAAC,GAAG,EAAE,QAAQ,EAAC,MAAM,gBAAgB,CAAC;AAC7C,OAAO,EAAe,kBAAkB,EAAS,iBAAiB,EAAC,MAAM,UAAU,CAAC;AACpF,OAAO,EAAC,OAAO,EAAE,kBAAkB,EAAC,MAAM,oBAAoB,CAAC;;;;;AAM/D,aAAa,MAAM,GAAG,IAAI,cAAc,CAAY,QAAQ,CAAC,CAAC;AAE9D,MAAM,OAAO,kBAAkB;;;;;;;IAC7B,YACY,QAAuC,QAAkB,EACzD,qBACA;QAFA,WAAM,GAAN,MAAM;QAAiC,aAAQ,GAAR,QAAQ,CAAU;QACzD,wBAAmB,GAAnB,mBAAmB;QACnB,sBAAiB,GAAjB,iBAAiB;KAAyB;;;;;;IAEtD,IAAI,CAAC,cAAwB,EAAE,KAAY;QACzC,IAAI,IAAI,CAAC,mBAAmB,EAAE;YAC5B,IAAI,CAAC,mBAAmB,CAAC,KAAK,CAAC,CAAC;SACjC;;QAED,MAAM,cAAc,GAAG,IAAI,CAAC,iBAAiB,oBAAC,KAAK,CAAC,YAAY,GAAG,CAAC;QAEpE,OAAO,cAAc,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC,OAA6B,EAAE,EAAE;YAC/D,IAAI,IAAI,CAAC,iBAAiB,EAAE;gBAC1B,IAAI,CAAC,iBAAiB,CAAC,KAAK,CAAC,CAAC;aAC/B;;YAED,MAAM,MAAM,GAAG,OAAO,CAAC,MAAM,CAAC,cAAc,CAAC,CAAC;YAE9C,OAAO,IAAI,kBAAkB,CACzB,OAAO,CAAC,MAAM,CAAC,QAAQ,CAAC,GAAG,CAAC,MAAM,CAAC,CAAC,CAAC,GAAG,CAAC,iBAAiB,CAAC,EAAE,MAAM,CAAC,CAAC;SAC1E,CAAC,CAAC,CAAC;KACL;;;;;IAEO,iBAAiB,CAAC,YAA0B;QAClD,IAAI,OAAO,YAAY,KAAK,QAAQ,EAAE;YACpC,OAAO,IAAI,CAAC,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,YAAY,CAAC,CAAC,CAAC;SAC7C;aAAM;YACL,OAAO,kBAAkB,CAAC,YAAY,EAAE,CAAC,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC,CAAM,EAAE,EAAE;gBACjE,IAAI,CAAC,YAAY,eAAe,EAAE;oBAChC,OAAO,EAAE,CAAE,CAAC,CAAC,CAAC;iBACf;qBAAM;oBACL,OAAO,IAAI,CAAC,IAAI,CAAC,QAAQ,CAAC,kBAAkB,CAAC,CAAC,CAAC,CAAC,CAAC;iBAClD;aACF,CAAC,CAAC,CAAC;SACL;;CAEJ","sourcesContent":["/**\n * @license\n * Copyright Google Inc. All Rights Reserved.\n *\n * Use of this source code is governed by an MIT-style license that can be\n * found in the LICENSE file at https://angular.io/license\n */\n\nimport {Compiler, InjectionToken, Injector, NgModuleFactory, NgModuleFactoryLoader} from '@angular/core';\n// TODO(i): switch to fromPromise once it's expored in rxjs\nimport {Observable, from, of } from 'rxjs';\nimport {map, mergeMap} from 'rxjs/operators';\nimport {LoadChildren, LoadedRouterConfig, Route, standardizeConfig} from './config';\nimport {flatten, wrapIntoObservable} from './utils/collection';\n\n/**\n * @docsNotRequired\n * @publicApi\n */\nexport const ROUTES = new InjectionToken<Route[][]>('ROUTES');\n\nexport class RouterConfigLoader {\n  constructor(\n      private loader: NgModuleFactoryLoader, private compiler: Compiler,\n      private onLoadStartListener?: (r: Route) => void,\n      private onLoadEndListener?: (r: Route) => void) {}\n\n  load(parentInjector: Injector, route: Route): Observable<LoadedRouterConfig> {\n    if (this.onLoadStartListener) {\n      this.onLoadStartListener(route);\n    }\n\n    const moduleFactory$ = this.loadModuleFactory(route.loadChildren !);\n\n    return moduleFactory$.pipe(map((factory: NgModuleFactory<any>) => {\n      if (this.onLoadEndListener) {\n        this.onLoadEndListener(route);\n      }\n\n      const module = factory.create(parentInjector);\n\n      return new LoadedRouterConfig(\n          flatten(module.injector.get(ROUTES)).map(standardizeConfig), module);\n    }));\n  }\n\n  private loadModuleFactory(loadChildren: LoadChildren): Observable<NgModuleFactory<any>> {\n    if (typeof loadChildren === 'string') {\n      return from(this.loader.load(loadChildren));\n    } else {\n      return wrapIntoObservable(loadChildren()).pipe(mergeMap((t: any) => {\n        if (t instanceof NgModuleFactory) {\n          return of (t);\n        } else {\n          return from(this.compiler.compileModuleAsync(t));\n        }\n      }));\n    }\n  }\n}\n"]}